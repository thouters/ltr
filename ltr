#!/usr/bin/env python
from sys import argv
from litter import LtrBox,LtrContext
import os

if __name__ == "__main__":
    
    opts = argv
    opts.pop(0)
    if len(argv):
        cmd = opts.pop(0)
    else:
        cmd = "status"

    if cmd == "create":
        uri = opts.pop(0).strip()
        directory = opts.pop(0)
        box = LtrBox()
        box.setPath(directory)
        box.newFromUri(LtrContext(uri))
        box.writeCookie()

    if cmd == "clone":
        name = opts.pop(0).strip()
        src = opts.pop(0).strip()
        dst = opts.pop(0).strip()

        srcbox = LtrBox().fromCookie(src)
        
        dstbox = LtrBox(srcbox.space)
        dstbox.setPath(dst)
        dstbox.setName(name)
        dstbox.new()
        dstbox.writeCookie()

    if cmd == "commit":
        #crawl, show diff of changes
        if len(opts):
            directory = opts.pop(0)
        else:
            directory = os.getcwd()
        box = LtrBox().fromCookie(directory)
        box.crawl(commit=True)

    if cmd == "diff":
        pass

    if cmd == "status":
        #crawl, show diff of changes
        if len(opts):
            directory = opts.pop(0)
        else:
            directory = os.getcwd()

        box = LtrBox().fromCookie(directory)
        box.crawl(commit=False)

    if cmd == "pull":
        dst = os.getcwd()
        src = opts.pop(0)
        dstbox = LtrBox().fromCookie(dst)

        srcbox = LtrBox(dstbox.space).fromCookie(src)

        dstbox.pull(srcbox)

